# 指纹识别Web应用框架

## 摘要
可以毫不夸张地说，几乎所有能想到的 Web 应用创意都已被投入开发。全球范围内积极开发和部署的大量免费开源软件项目，使得应用安全测试极有可能遇到完全或部分依赖于这些知名应用或框架（例如 WordPress、phpBB、Mediawiki 等）的目标。了解被测试的 Web 应用组件能显著帮助测试过程，并大大减少测试期间所需的工作量。这些知名的 Web 应用具有特定的 HTML 头部、Cookie 和目录结构，可以通过枚举来识别应用。大多数 Web 框架在这些位置都有若干标记，这有助于攻击者或测试人员识别它们。这基本上是所有自动化工具的工作原理：它们从预定义的位置寻找标记，然后与已知签名数据库进行比较。为了提高准确性，通常会使用多个标记。

## 测试目标

- 对 Web 应用使用的组件进行指纹识别。

## 测试方法

### 黑盒测试

识别框架或组件时，有几个常见的位置需要考虑：

- HTTP 头部
- Cookie
- HTML 源代码
- 特定文件和文件夹
- 文件扩展名
- 错误消息

#### HTTP 头部

识别 Web 框架最基本的形式是查看 HTTP 响应头中的 `X-Powered-By` 字段。许多工具可用于对目标进行指纹识别，最简单的是 netcat。

考虑以下 HTTP 请求-响应：

```html
$ nc 127.0.0.1 80
HEAD / HTTP/1.0

HTTP/1.1 200 OK
Server: nginx/1.0.14
[...]
X-Powered-By: Mono
```

从 `X-Powered-By` 字段可知，该 Web 应用框架很可能是 `Mono`。然而，尽管这种方法简单快捷，但并非在所有情况下都有效。通过适当配置，可以轻松禁用 `X-Powered-By` 标头。此外，还存在多种技术可使站点混淆 HTTP 头部（示例参见[修复措施](#修复)部分）。在上例中，我们还可以注意到用于提供内容服务的 `nginx` 具体版本。

在同一个示例中，测试人员可能遗漏 `X-Powered-By` 标头，或得到如下响应：

```html
HTTP/1.1 200 OK
Server: nginx/1.0.14
Date: Sat, 07 Sep 2013 08:19:15 GMT
Content-Type: text/html;charset=ISO-8859-1
Connection: close
Vary: Accept-Encoding
X-Powered-By: Blood, sweat and tears
```

有时会出现更多指向特定框架的 HTTP 头部。在下例中，根据 HTTP 请求信息可见 `X-Powered-By` 标头包含 PHP 版本，但 `X-Generator` 标头表明实际使用的框架是 `Swiftlet`，这有助于渗透测试人员扩展攻击向量。执行指纹识别时，应仔细检查每个 HTTP 标头是否存在此类信息泄露。

```html
HTTP/1.1 200 OK
Server: nginx/1.4.1
Date: Sat, 07 Sep 2013 09:22:52 GMT
Content-Type: text/html
Connection: keep-alive
Vary: Accept-Encoding
X-Powered-By: PHP/5.4.16-1~dotdeb.1
Expires: Thu, 19 Nov 1981 08:52:00 GMT
Cache-Control: no-store, no-cache, must-revalidate, post-check=0, pre-check=0
Pragma: no-cache
X-Generator: Swiftlet
```

#### Cookies

另一种类似且更可靠的识别当前 Web 框架的方法是框架特定的 Cookie。

观察以下 HTTP 请求：

![Cakephp HTTP 请求](images/Cakephp_cookie.png)\
*图 WSTG：Cakephp HTTP 请求*

Cookie `CAKEPHP` 已自动设置，这提供了有关所使用框架的信息。常见 Cookie 名称列表见 [Cookies](#cookies-1) 部分。依赖此识别机制仍存在局限性——可以更改 Cookie 的名称。例如，对于选定的 `CakePHP` 框架，可通过以下配置实现（摘自 `core.php`）：

```php
/**
* The name of CakePHP's session cookie.
*
* Note the guidelines for Session names states: "The session name references
* the session id in cookies and URLs. It should contain only alphanumeric
* characters."
* @link https://php.net/session_name
*/
Configure::write('Session.cookie', 'CAKEPHP');
```

然而，相比修改 `X-Powered-By` 标头，此类更改发生的可能性更低，因此该识别方法更为可靠。

#### HTML 源代码分析技术

该技术基于在 HTML 页面源代码中寻找特定模式。测试人员通常可从中发现大量信息，有助于识别特定组件。常见标记包括直接暴露框架的 **HTML 注释**。更常见的是，可发现某些**框架专属路径**（例如指向框架专用 CSS 或 JS 文件夹的链接）。此外，特定的**脚本变量**也可能指向特定框架。

从下方截图可见，通过上述标记可轻松确定所用框架及其版本。注释、特定路径和脚本变量均可帮助攻击者快速识别 ZK 框架的实例。

![ZK 框架示例](images/Zk_html_source.png)\
*图 WSTG：ZK 框架 HTML 源代码示例*

此类信息通常位于 HTTP 响应的 `<head>` 区域、`<meta>` 标签或页面底部。但仍应分析完整响应，因其可能包含其他有用信息（如检查其他注释或隐藏字段）。有时，Web 开发者可能未充分混淆所用框架或组件的信息，仍可能在页面底部发现如下内容：

![Banshee 页面底部](images/Banshee_bottom_page.png)\
*图 WSTG：Banshee 页面底部示例*

### 特定文件与目录

另一种能极大帮助攻击者或测试人员高精度识别应用程序或组件的方法是：每个 Web 应用组件在服务器上都有其特定的文件和目录结构。值得注意的是，虽然可通过 HTML 页面源代码查看具体路径，但有时这些路径不会显式呈现，却仍存在于服务器上。

为发现这些路径，需使用一种称为强制浏览（forced browsing）或“目录爆破”（dirbusting）的技术。目录爆破是指通过已知目录和文件名对目标进行暴力破解，并监控 HTTP 响应以枚举服务器内容。该技术既可用于发现默认文件并发起攻击，也可用于识别 Web 应用指纹。目录爆破可通过多种方式实现，下图展示了借助预定义字典和 Burp Suite 的 Intruder 功能，对 WordPress 目标成功进行目录爆破的示例：

![Dirbusting with Burp](images/Wordpress_dirbusting.png)  
*图 WSTG：使用 Burp 进行目录爆破*

可见，针对 WordPress 特定目录（如 `/wp-includes/`、`/wp-admin/` 和 `/wp-content/`），HTTP 响应分别为 403（禁止访问）、302（重定向至 `wp-login.php`）和 200（成功）。这明确表明目标由 WordPress 驱动。同理可爆破不同应用插件目录及其版本。下图为典型的 Drupal 插件 CHANGELOG 文件，其揭示了应用类型并暴露了存在漏洞的插件版本：

![Drupal Botcha Disclosure](images/Drupal_botcha_disclosure.png)  
*图 WSTG：Drupal Botcha 信息泄露*

**提示**：开始目录爆破前，首先检查 `robots.txt` 文件。该文件有时会包含应用特定目录或其他敏感信息。下图展示了此类文件的示例：

![Robots Info Disclosure](images/Robots-info-disclosure.png)  
*图 WSTG：Robots 信息泄露*

不同应用的特定文件和目录各不相同。若识别出开源应用或组件，渗透测试时可搭建临时环境以深入理解其基础设施、功能及可能残留的服务器文件。已有现成的实用文件列表，例如 [FuzzDB 可预测文件/目录字典](https://github.com/fuzzdb-project/fuzzdb)。

**文件扩展名**

URL 中的文件扩展名也有助于识别 Web 平台或技术。

例如，OWASP Wiki 使用 PHP：  

```text
https://wiki.owasp.org/index.php?title=Fingerprint_Web_Application_Framework&action=edit&section=4
```

常见 Web 文件扩展名及关联技术：

- `.php` —— PHP
- `.aspx` —— Microsoft ASP.NET
- `.jsp` —— Java Server Pages

#### 错误信息

如下图所示，文件系统路径暴露了 WordPress 的使用（`wp-content`）。测试人员还应注意 WordPress 基于 PHP（`functions.php`）：

![WordPress Parse error](images/wp-syntaxerror.png)  
*图 WSTG：WordPress 解析错误*

## Common Identifiers

### Cookies

| Framework    | Cookie name                       |
|--------------|-----------------------------------|
| Zope         | zope3                             |
| CakePHP      | cakephp                           |
| Kohana       | kohanasession                     |
| Laravel      | laravel_session                   |
| phpBB        | phpbb3_                           |
| WordPress    | wp-settings                       |
| 1C-Bitrix    | BITRIX_                           |
| AMPcms       | AMP                               |
| Django CMS   | django                            |
| DotNetNuke   | DotNetNukeAnonymous               |
| e107         | e107_tz                           |
| EPiServer    | EPiTrace, EPiServer               |
| Graffiti CMS | graffitibot                       |
| Hotaru CMS   | hotaru_mobile                     |
| ImpressCMS   | ICMSession                        |
| Indico       | MAKACSESSION                      |
| InstantCMS   | InstantCMS[logdate]               |
| Kentico CMS  | CMSPreferredCulture               |
| MODx         | SN4[12symb]                       |
| TYPO3        | fe_typo_user                      |
| Dynamicweb   | Dynamicweb                        |
| LEPTON       | lep[some_numeric_value]+sessionid |
| Wix          | Domain=.wix.com                   |
| VIVVO        | VivvoSessionId                    |
| Tiny File Manager | filemanager                  |
| Zenphoto     | zenphoto_auth                     |

### HTML Source Code

| Application | Keyword                                                                        |
|-------------|--------------------------------------------------------------------------------|
| WordPress   | `<meta name="generator" content="WordPress 3.9.2" />`                          |
| phpBB       | `<body id="phpbb"`                                                             |
| Mediawiki   | `<meta name="generator" content="MediaWiki 1.21.9" />`                         |
| Joomla      | `<meta name="generator" content="Joomla! - Open Source Content Management" />` |
| Drupal      | `<meta name="Generator" content="Drupal 7 (https://drupal.org)" />`             |
| DotNetNuke  | `DNN Platform - [https://www.dnnsoftware.com](https://www.dnnsoftware.com)`      |

#### General Markers

- `%framework_name%`
- `powered by`
- `built upon`
- `running`

#### Specific Markers

| Framework         | Keyword                        |
|-------------------|--------------------------------|
| Adobe ColdFusion  | `<!-- START headerTags.cfm` |
| Microsoft ASP.NET | `__VIEWSTATE`                  |
| ZK                | `<!-- ZK`                   |
| Business Catalyst | `<!-- BC_OBNW -->`       |
| Indexhibit        | `ndxz-studio`                  |

## 修复

虽可尝试修改配置以变更 Cookie 名称、隐藏或更改文件/目录路径（通过重写规则或源码修改）、移除已知标头等，但这些举措本质上属于"隐蔽安全"（security through obscurity）。系统所有者/管理员应认识到，此类措施仅能延缓最基础的攻击者。将时间和精力用于提升相关方安全意识及维护解决方案可能更具价值。

## 工具

以下列举常用工具清单，此外还存在大量其他实用程序及基于框架的指纹识别工具。

### WhatWeb

官网：[https://github.com/urbanadventurer/WhatWeb](https://github.com/urbanadventurer/WhatWeb)

WhatWeb 是当前市场上最佳开源指纹识别工具之一，默认集成于 [Kali Linux](https://www.kali.org/) 系统。
编程语言：Ruby。指纹匹配方式包括：

- 文本字符串（区分大小写）
- 正则表达式
- Google Hack Database 查询（关键词有限）
- MD5 哈希值
- URL 识别
- HTML 标签模式
- 用于被动/主动操作的 Ruby 自定义代码

输出示例如下图所示：  
![Whatweb 输出示例](images/Whatweb-sample.png)  
*图 WSTG：Whatweb 输出示例*

**Wappalyzer**

官网：[https://www.wappalyzer.com/](https://www.wappalyzer.com/)

Wappalyzer 提供多种使用模式，最受欢迎的当属 Firefox/Chrome 浏览器扩展。该工具主要基于正则表达式匹配，仅需加载页面即可工作，完全在浏览器层面运行并以图标形式返回结果。虽偶有误报，但能在访问页面后立即识别目标站点的构建技术，极为便捷。

插件输出示例如下图所示：  
![OWASP 网站的 Wappalyzer 输出](images/Owasp-wappalyzer.png)  
*图 WSTG：OWASP 站点的 Wappalyzer 输出*

## References

- [WSTG-INFO-08](https://github.com/OWASP/wstg/blob/master/document/4-Web_Application_Security_Testing/01-Information_Gathering/08-Fingerprint_Web_Application_Framework.md)

### Whitepapers

- [Saumil Shah: "An Introduction to HTTP fingerprinting"](https://web.archive.org/web/20190526182734/https://net-square.com/httprint_paper.html)
- [Anant Shrivastava : "Web Application Finger Printing"](https://anantshri.info/articles/web_app_finger_printing.html)