# 测试路径混淆漏洞

## 概述

正确配置应用程序路径非常重要，因为如果路径配置不当，攻击者可能利用此配置缺陷在后续阶段实施其他漏洞攻击。

例如，若路由配置不正确且目标系统同时使用了CDN（内容分发网络），攻击者可能通过此配置缺陷实施Web缓存欺骗攻击。

因此，为防止其他攻击，测试人员应对此项配置进行评估。

## 测试目标

- 确保应用程序路径配置正确无误。

## 测试方法

### 黑盒测试
在黑盒测试场景中，测试人员应将所有现有路径替换为不存在的路径，然后观察目标系统的响应行为和状态码。

例如，应用程序中存在一个显示用户账户余额（资金、游戏点数等）的仪表板路径。

假设路径为 `https://example.com/user/dashboard`，测试人员应验证开发人员可能为该路径设置的不同模式。对于Web缓存欺骗漏洞，若仪表板信息可见且目标系统使用了CDN（或其他Web缓存），分析人员应考虑测试类似 `https://example.com/user/dashboard/non.js` 的路径，此时很可能存在Web缓存欺骗攻击风险。

### 白盒测试
检查应用程序的路由配置。大多数情况下，开发者会在应用路由中使用正则表达式。

以下示例在Django框架应用的 `urls.py` 文件中展示了路径混淆问题。开发者因未使用正确的正则表达式导致漏洞：

```python
from django.urls import re_path
from . import views

urlpatterns = [
    re_path(r'.*^dashboard', views.path_confusion ,name = 'index'),
]
```

若浏览器中打开 `https://example.com/dashboard/none.js` 路径时仍显示用户仪表板信息，且目标系统使用CDN或Web缓存，则可能实施Web缓存欺骗攻击。

## 工具

- [Zed Attack Proxy](https://www.zaproxy.org)
- [Burp Suite](https://portswigger.net/burp)

## 修复措施

- 避免基于文件扩展名或路径对缓存进行分类/处理（应优先依据内容类型）。
- 确保缓存机制遵循应用程序指定的缓存控制标头。
- 实施符合RFC标准的文件未找到处理机制和重定向规则。

## 参考资源

- [WSTG-CONF-13](https://github.com/OWASP/wstg/blob/master/document/4-Web_Application_Security_Testing/02-Configuration_and_Deployment_Management_Testing/13-Test_for_Path_Confusion.md)
- [绕过Web缓存投毒对策](https://portswigger.net/research/bypassing-web-cache-poisoning-countermeasures)
- [路径混淆：Web缓存欺骗攻击威胁用户信息安全](https://portswigger.net/daily-swig/path-confusion-web-cache-deception-threatens-user-information-online)
- [Web缓存欺骗攻击详解](https://omergil.blogspot.com/2017/02/web-cache-deception-attack.html)
