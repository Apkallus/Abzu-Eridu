# 测试网络基础设施配置

## 摘要

互连且异构的Web服务器基础设施（可能包含数百个Web应用程序）具有内在复杂性，这使得配置管理和审查成为测试和部署每个应用程序的基本步骤。仅需一个漏洞即可破坏整个基础设施的安全性，即使是看似微不足道的小问题，也可能导致同一服务器上其他应用程序的严重风险。为解决这些问题，必须在完成整个架构映射后，对配置和已知安全问题执行深度审查。

对Web服务器基础设施实施妥善的配置管理，对保障应用程序自身安全至关重要。若未正确审查和保护Web服务器软件、后端数据库服务器或认证服务器等组件，可能引发意外风险或引入新的漏洞，进而危害应用程序本身。

例如，Web服务器漏洞若允许攻击者远程泄露应用程序源代码（此类漏洞在Web服务器和应用服务器中屡次出现），将直接危及应用程序安全——攻击者可利用源代码披露的信息，对应用程序或其用户发起攻击。

测试配置管理基础设施需执行以下步骤：
- **确定基础设施组件**：明确构成基础设施的不同元素，理解其与Web应用的交互方式及对安全性的影响；
- **审查组件安全性**：检查所有基础设施元素，确保不存在已知漏洞；
- **评估管理工具**：审查用于维护各元素的管理工具；
- **验证认证系统**：确保认证系统满足应用需求，且不会被外部用户操纵以获取访问权限；
- **管控端口配置**：对应用程序所需的定义端口列表进行维护，并实施变更控制。

完成基础设施组件映射（参见[映射应用架构](../1.%20信息收集/1.10%20映射应用架构.md)）后，即可审查每个元素的配置并测试已知漏洞。

## 测试目标

- 审查应用程序在网络中的配置设置，并验证其是否存在漏洞。
- 验证所使用的框架和系统的安全，是否因未维护的软件、默认设置或凭据而受到已知漏洞的影响。

## 测试方法

### 已知服务器漏洞

应用程序架构中各个层面的漏洞（无论是Web服务器还是后端数据库）都可能严重危害应用安全。例如，若存在允许未经认证的远程用户向Web服务器上传文件甚至替换现有文件的漏洞，恶意用户可能直接替换应用程序本身或植入影响后端服务器的代码，因为这些代码会像正常应用一样被执行。

若需通过盲渗透测试审查服务器漏洞，其难度将大幅增加。此类场景需通过远程站点（通常使用自动化工具）测试漏洞。然而，部分漏洞测试可能导致Web服务器出现不可预测的结果；而另一些漏洞（如直接导致拒绝服务攻击的漏洞）则因测试成功会造成服务中断，根本无法进行有效测试。

自动化工具常依据获取的Web服务器版本标记漏洞，这会导致误报和漏报：  
- 若管理员移除或隐藏服务器版本号，即使存在漏洞，扫描工具也无法识别；  
- 若软件供应商修复漏洞后未更新版本号，工具会标记不存在的漏洞。后者在GNU/Linux发行版（如Debian、Red Hat和SuSE）中极为常见——系统供应商仅将安全补丁移植到现有软件，而非完整升级至最新版本。  
此外，漏洞扫描通常仅能发现架构中"暴露"部分（如Web服务器）的漏洞，而难以检测未直接暴露的组件（如认证后端、数据库或反向代理 [1]）的漏洞。

最后，并非所有供应商都会公开披露漏洞，导致这些弱点未被纳入已知漏洞库 [2]。相关信息仅向客户披露或通过无通告的补丁发布，大幅削弱了扫描工具的有效性。因此，对主流产品（如Apache、Microsoft IIS、IBM Lotus Domino）的漏洞覆盖较全面，而对小众产品则不足。

测试者获取软件内部信息（包括版本号、发布状态和已安装补丁）时审查漏洞效果最佳。借此可分析架构中的潜在漏洞及其影响，并在条件允许时实测漏洞效果，检测是否存在外部因素（如入侵检测或防御系统）削弱攻击可行性。配置审查甚至可能发现漏洞实际上并不影响运行中的组件（影响的是未使用的组件）。

同样值得注意的是，供应商有时通过新版本静默修复漏洞。不同供应商的发布周期各异，这决定了他们可能对旧版本的支持。掌握系统所用软件版本的详细信息后，测试者可评估使用短期或长期不再受支持的旧版软件的风险——此类版本若出现漏洞，系统管理员可能无法直接察觉。由于不再提供补丁且安全通告不再将其列为受影响版本。即便知晓漏洞及相关系统风险，仍需完整升级至新版软件，而这将导致应用架构面临长时间停机，或因兼容性问题需重新编写代码。

### 管理工具

任何 Web 服务器基础设施都需要管理工具来维护和更新应用程序所使用的信息。这些信息包括静态内容（网页、图形文件）、应用程序源代码、用户认证数据库等。所使用的管理工具类型可能因具体站点、技术或软件而异。例如，部分 Web 服务器会通过本身也是 Web 服务器的管理界面（如 iPlanet Web Server）进行管理，或通过纯文本配置文件（如 Apache [3]）进行管理，或使用操作系统 GUI 工具（如使用 Microsoft 的 IIS 服务器或 ASP.NET）。

大多数情况下，服务器配置通过各种文件维护工具进行管理，通过 FTP 服务器、WebDAV、网络文件系统（NFS、CIFS）或其他机制进行管理。显然，构成应用架构的各组件的操作系统也将通过其他工具进行管理。应用程序还可能包含用于管理应用数据（用户、内容等）的嵌入式管理界面。

在映射用于管理架构不同部分的管理界面后，对其进行审查至关重要。若攻击者获得任何此类界面的访问权限，则可能破坏或损害应用架构。为实现此目标，重要的是：
- 确定这些界面访问的机制及其相关的脆弱性，此类信息可能在线获取。
- 确保默认用户名和密码已更改。

部分企业选择不管理其 Web 服务器应用的所有方面，可能将内容管理委托给其他方。此外部公司可能仅提供部分内容（如新闻更新或促销），或完全管理 Web 服务器（包括内容和代码）。在此类情况下，常可发现管理界面可通过互联网访问，因为使用互联网比提供专线连接外部公司至应用架构（通过仅管理界面）更经济。在此类情况下，测试管理界面是否易受攻击至关重要。

## 参考文献

- [WSTG-CONF-01](https://github.com/OWASP/wstg/blob/master/document/4-Web_Application_Security_Testing/02-Configuration_and_Deployment_Management_Testing/01-Test_Network_Infrastructure_Configuration.md)
-  WebSEAL（又称 Tivoli 认证管理器）是 IBM 的反向代理，属于 Tivoli 框架的一部分。
-  例如赛门铁克的 Bugtraq、ISS 的 X-Force 或 NIST 的国家漏洞数据库（NVD）。
-  存在一些基于 GUI 的 Apache 管理工具（如 NetLoony），但它们尚未被广泛使用。
