# 测试HTTP严格传输安全（HSTS）

## 摘要

HTTP严格传输安全（HSTS）功能使Web服务器能够通过特殊的响应头通知用户的浏览器，它永远不应与指定的域服务器建立未加密的HTTP连接。相反，它应自动建立所有通过HTTPS访问站点的连接请求。这也防止用户覆盖证书错误。

考虑到此安全措施的重要性，谨慎的做法是验证站点是否使用了此HTTP头，以确保所有数据在Web浏览器和服务器之间加密传输。

HTTP严格传输安全头使用三个特定指令：

-   `max-age`：指示浏览器应自动将所有HTTP请求转换为HTTPS的秒数。
-   `includeSubDomains`：表示所有相关子域必须使用HTTPS。
-   `preload` 非官方：表示域在预加载列表中，并且浏览器不应在没有HTTPS的情况下连接。
    -   虽然所有主流浏览器都支持此功能，但它不是规范的官方部分。（有关详细信息，请参阅 [hstspreload.org](https://hstspreload.org))。

以下是HSTS头实现的示例：

```http
Strict-Transport-Security: max-age=31536000; includeSubDomains
```

必须检查此标头是否存在，因为缺少此标头可能会导致安全问题，例如：

-   攻击者拦截和访问通过未加密网络通道传输的信息。
-   攻击者利用接受不受信任证书的用户进行中间人（MITM）攻击。
-   在浏览器中错误输入地址使用HTTP而不是HTTPS的用户，或者单击错误使用HTTP协议的Web应用程序中的链接的用户。

## 测试目标

- 审查 HSTS 头及其有效性。

## 如何测试

- 通过拦截代理检查服务器的响应来确认 HSTS 头的存在。
- 使用 curl 如下：

```bash
$ curl -s -D- https://owasp.org | grep -i strict-transport-security:
Strict-Transport-Security: max-age=31536000
```

## References

- [WSTG-CONF-07](https://github.com/OWASP/wstg/blob/master/document/4-Web_Application_Security_Testing/02-Configuration_and_Deployment_Management_Testing/07-Test_HTTP_Strict_Transport_Security.md)
- [OWASP HTTP Strict Transport Security](https://cheatsheetseries.owasp.org/cheatsheets/HTTP_Strict_Transport_Security_Cheat_Sheet.html)
- [OWASP Appsec Tutorial Series - Episode 4: Strict Transport Security](https://www.youtube.com/watch?v=zEV3HOuM_Vw)
- [HSTS Specification](https://tools.ietf.org/html/rfc6797)
- [Enable HTTP Strict Transport Security In Apache](https://https.cio.gov/hsts/)
- [Enable HTTP Strict Transport Security In Nginx](https://www.nginx.com/blog/http-strict-transport-security-hsts-and-nginx/)