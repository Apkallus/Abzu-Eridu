# 测试弱安全问答

## 概述

通常被称为“秘密”问题与答案的安全问题，常被用于找回遗忘的密码（参见[WSTG 测试弱密码修改或重置功能](09-Testing_for_Weak_Password_Change_or_Reset_Functionalities.md)），或作为密码之外的额外安全层。

安全问题通常在账户创建时生成，要求用户从预生成问题中选择并提供对应答案。部分系统允许用户自定义问题与答案对，但两种方式均存在安全隐患。理想情况下，安全问题的答案应仅为用户本人知晓，且不可被他人猜测或探测——这实际实现起来比听起来更困难。

安全问题与答案的核心在于答案的保密性。所选问题应确保答案仅限账户持有者知悉。然而，尽管许多答案并非公开信息，但大多数网站设置的问题往往导向“伪私有”型答案。

### 预生成问题

大多数预生成问题本质上较为简单，可能导致答案安全性不足。例如：

- 答案可能被用户家庭成员或好友知晓，如"您母亲的婚前姓氏是什么？"、"您的出生日期是什么？"
- 答案可能容易被猜测，如"您最喜欢的颜色是什么？"、"您最喜爱的棒球队是？"
- 答案可能被暴力破解，如"您高中最喜欢的老师名字是什么？"——答案可能存在于易下载的常见名字列表中，因此可编写脚本进行简单暴力攻击
- 答案可能公开可查，如"您最喜欢的电影是什么？"——答案可能轻易从用户社交媒体主页获取

### 自生成问题

允许用户自行生成问题存在缺陷：用户可能设置安全性极低的问题，甚至完全绕过安全问题的设立初衷。以下真实案例可说明此问题：

- "1+1等于多少？"
- "您的用户名是什么？"
- "我的密码是S3curIty！"

## 测试目标

- 判断安全问题的复杂性与直接程度
- 评估可能的用户答案与暴力破解可行性

## 测试方法

### 测试弱预生成问题

通过创建新账户或执行“忘记密码”流程尝试获取安全问题列表。尽可能生成多组问题以全面了解所设安全问题的类型。若任何安全问题属于前述类别（可猜测、可暴力破解、社交媒体可查等），则表明该问题易受攻击。

### 测试弱自生成问题

通过注册新账户或配置现有账户的密码恢复设置尝试创建安全问题。若系统允许用户自定义安全问题，则存在生成低安全性问题的风险。如果在忘记密码流程中采用自生成安全问题，且用户名可被枚举（参见[WSTG 测试账户枚举与可猜测用户账户](../03-Identity_Management_Testing/04-Testing_for_Account_Enumeration_and_Guessable_User_Account.md)），测试人员可轻松枚举大量自生成问题。通过此方法预计能发现多个弱自生成问题。

### 测试可暴力破解的答案

使用[WSTG 测试弱锁定机制](03-Testing_for_Weak_Lock_Out_Mechanism.md)中描述的方法，判断连续输入错误安全问题答案是否会触发账户锁定机制。

尝试利用安全问题时，首先需关注需要回答的问题数量。大多数应用仅要求用户回答一个问题，而某些关键应用可能要求回答两个甚至更多问题。

下一步是评估安全问题的强度：答案能否通过简单搜索引擎查询或社会工程攻击获取？作为渗透测试人员，以下是利用安全问题机制的完整步骤：

- 应用是否允许终端用户选择需回答的问题？若允许，重点关注具有以下特征的问题：
    - 答案可公开获取（例如可通过简单搜索引擎查询获得）
    - 存在事实性答案（如"第一所学校"等可查证的信息）
    - 答案可能性有限（如"您的第一辆汽车型号"）。此类问题会为攻击者提供简短的候选答案列表，攻击者可基于统计概率对答案进行可能性排序

- 尽可能确定可尝试猜测的次数：
    - 密码重置功能是否允许无限次尝试？
    - 错误回答X次后是否会触发锁定周期？需注意锁定机制本身可能成为安全隐患，攻击者可利用其对合法用户发起拒绝服务攻击

- 基于以上分析选择合适问题，并通过调研确定最可能的答案

成功利用并绕过弱安全问题机制的关键在于：找到能够轻松获取答案的问题或问题组合。若对所有答案均不确定，应始终选择统计意义上猜测正确率最高的问题。最终，安全问题机制的安全性完全取决于其中最弱环节的强度。

## References
- [WSTG-ATHN-08](https://github.com/OWASP/wstg/blob/master/document/4-Web_Application_Security_Testing/04-Authentication_Testing/08-Testing_for_Weak_Security_Question_Answer.md)
- [The Curse of the Secret Question](https://www.schneier.com/essay-081.html)
- [The OWASP Security Questions Cheat Sheet](https://cheatsheetseries.owasp.org/cheatsheets/Choosing_and_Using_Security_Questions_Cheat_Sheet.html)