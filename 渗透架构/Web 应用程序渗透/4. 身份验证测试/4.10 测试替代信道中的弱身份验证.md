# 测试替代信道中的弱身份验证

## 概述

即使主要认证机制不存在任何漏洞，同一用户账户的其他合法认证渠道仍可能存在安全隐患。测试人员应识别这些替代渠道，并根据测试范围评估相关漏洞。

替代用户交互渠道可能被用于绕过主渠道，或泄露可用于攻击主渠道的信息。部分渠道可能是使用不同主机名或路径的独立网络应用，例如：

- 标准网站
- 移动端或特定设备优化网站
- 无障碍优化网站
- 不同国家/语言版本网站
- 使用相同用户账户的并行网站（例如：同一机构提供不同功能的网站、共享用户账户的合作方网站）
- 标准网站的开发版、测试版、UAT版和预发布版

但此类渠道也可能包含其他类型的应用程序或业务流程：

- 移动设备应用程序
- 桌面应用程序
- 呼叫中心操作员
- 交互式语音应答或电话树系统

注意，本测试的重点在于替代渠道；某些认证替代方案可能表现为通过同一网站交付的不同内容，这类情况几乎必然属于测试范围。此处不再赘述，应在信息收集和主要认证测试阶段完成识别。例如：

- 改变功能的渐进式增强与优雅降级
- 无Cookie的网站使用
- 无JavaScript的网站使用
- 无插件（如Flash和Java）的网站使用

即使测试范围不允许对替代渠道进行测试，也应对其存在进行记录。这些渠道可能降低认证机制的可信度，并可能成为后续补充测试的前置条件。

## 示例

主网站为 `https://www.example.com`，认证功能始终在使用 TLS 的页面上进行：`https://www.example.com/myaccount/`。

然而，存在一个独立的移动优化网站，该网站完全不使用 TLS，且具有较弱的密码恢复机制：`http://m.example.com/myaccount/`。

## 测试目标

- 识别替代认证渠道
- 评估替代渠道所使用的安全措施及是否存在可被绕过的漏洞

## 测试方法

### 理解主要机制

全面测试网站的主要认证功能。这应包括确定账户的发放、创建或修改方式，以及密码的恢复、重置或更改流程。此外，需了解任何提升权限的认证方式及认证保护措施。这些前置步骤对于与任何替代渠道进行对比是必要的。

### 识别其他渠道

可通过以下方法发现其他渠道：

- 查阅网站内容，特别是首页、联系我们、帮助页面、支持文章与常见问题解答、服务条款、隐私声明、`robots.txt` 文件及任何 `sitemap.xml` 文件
- 在先前信息收集和测试阶段记录的 HTTP 代理日志中，搜索 URL 路径和正文内容中包含的字符串（如 "mobile"、"android"、"blackberry"、"ipad"、"iphone"、"mobile app"、"e-reader"、"wireless"、"auth"、"sso"、"single sign on"）
- 使用搜索引擎查找同一组织的不同网站，或使用相同域名且具有相似首页内容或认证机制的网站

对于每个可能的渠道，需确认用户账户是否跨渠道共享，或是否提供相同/相似功能的访问权限。

### 枚举认证功能

对于共享用户账户或功能的每个替代渠道，需识别主要渠道的所有认证功能是否可用，以及是否存在额外功能。可参考以下表格形式进行梳理：

| 功能项       | 主要渠道 | 移动端 | 呼叫中心 | 合作方网站 |
|-------------|---------|--------|----------|------------|
| 注册账号    | 支持     | 不支持 | 不支持   | 不支持     |
| 登录        | 支持     | 支持   | 支持     | 支持(单点登录) |
| 注销        | 支持   | 不支持 | 不支持   | 不支持     |
| 密码重置    | 支持     | 支持   | 支持     | 不支持     |
| 密码修改    | 不支持   | 支持   | 不支持   | 不支持     |

本例中，移动端额外提供"密码修改"功能但未提供"注销"功能。呼叫中心也可处理有限任务。呼叫中心尤其值得关注，因其身份验证强度可能弱于网站，可能成为攻击用户账户的辅助渠道。

枚举过程中需注意会话管理机制，特别是跨渠道的会话重叠情况（例如：作用域为相同父域名的Cookie、允许跨渠道并发会话但同一渠道内禁止等）。

### 审查与测试

测试报告中应提及替代渠道，即使其被标记为"仅信息"或"超出范围"。若测试范围包含替代渠道（例如因该渠道仅为目标主机的另一路径），或经与渠道所有者协商后纳入范围，则需执行本指南中所有其他认证测试，并与主要渠道进行对比分析。

## 相关测试用例

应运用所有其他认证测试的测试用例。

## 修复措施

确保所有渠道采用统一的认证策略，保障各渠道安全强度一致。

## 引用

- [WSTG-ATHN-10](https://github.com/OWASP/wstg/blob/master/document/4-Web_Application_Security_Testing/04-Authentication_Testing/10-Testing_for_Weaker_Authentication_in_Alternative_Channel.md#how-to-test)