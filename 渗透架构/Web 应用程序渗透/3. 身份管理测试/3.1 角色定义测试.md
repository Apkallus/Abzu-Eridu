# 角色定义测试

## 概述

应用程序包含多种功能和服务，这些功能和服务需要根据用户需求授予相应的访问权限。用户类型包括：

- **管理员**：负责管理应用程序功能
- **审计员**：负责审查应用程序交易记录并生成详细报告
- **技术支持工程师**：协助客户调试和修复账户问题
- **客户**：使用应用程序服务

为应对这些使用场景及其他潜在需求，应用程序会设置角色定义（通常称为[基于角色的访问控制(RBAC)](https://en.wikipedia.org/wiki/Role-based_access_control)）。通过角色分配，用户能够完成所需任务。

## 测试目标

- 识别并记录应用程序使用的角色
- 尝试切换、修改或访问其他角色
- 审查角色的权限粒度及权限分配的必要性

## 测试方法

### 角色识别

测试人员应通过以下任一方法开始识别被测试应用程序的角色：
- 应用程序文档
- 开发人员或管理员的指导说明
- 应用程序注释信息
- 模糊测试可能的角色：
    - Cookie变量（例如 `role=admin`，`isAdmin=True`）
    - 账户变量（例如 `Role: manager`）
    - 隐藏目录或文件（例如 `/admin`，`mod`，`/backups`）
    - 切换至常见用户名（例如 `admin`，`backups` 等）

### 切换可用角色

识别可能的攻击向量后，测试人员需要验证是否能够访问这些可用角色。

> 部分应用程序会在用户创建时通过严格检查策略定义角色，或通过后端生成的签名确保用户角色得到有效保护。发现角色存在并不代表其本身构成安全漏洞。

### 审查角色权限

成功获取系统角色访问权限后，测试人员必须深入理解每个角色被授予的具体权限。

技术支持工程师不应具备执行管理功能、管理备份或替代用户执行任何交易的权限。

管理员不应拥有系统的绝对控制权。敏感的管理功能应采用双人复核原则，或使用多因素认证来确保管理员操作的合法性。2020年的[Twitter安全事件](https://blog.twitter.com/en_us/topics/company/2020/an-update-on-our-security-incident.html)就是这方面的典型案例。

## 测试工具

上述测试可不依赖特定工具完成，仅使用访问系统所需的常规工具即可。

为提升测试效率和完善文档记录，推荐使用：
- [Burp的Autorize扩展插件](https://github.com/Quitten/Autorize)
- [ZAP的访问控制测试插件](https://www.zaproxy.org/docs/desktop/addons/access-control-testing/)

## 参考文献

- [WSTG-IDNT-01](https://github.com/OWASP/wstg/blob/master/document/4-Web_Application_Security_Testing/03-Identity_Management_Testing/01-Test_Role_Definitions.md)
- [Role Engineering for Enterprise Security Management, E Coyne & J Davis, 2007](https://www.bookdepository.co.uk/Role-Engineering-for-Enterprise-Security-Management-Edward-Coyne/9781596932180)
- [NIST角色工程与RBAC标准](https://csrc.nist.gov/projects/role-based-access-control#rbac-standard)
