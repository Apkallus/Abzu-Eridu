# 测试伪造请求的能力

## 摘要  

伪造请求是攻击者用来绕过前端GUI应用程序，直接向后端提交信息进行处理的一种方法。攻击者的目标是通过拦截代理发送带有不被应用程序业务逻辑支持、防护或预期的数据值的HTTP POST/GET请求。伪造请求的示例包括利用可猜测或可预测的参数，或暴露“隐藏”的功能（例如启用调试模式或展示开发阶段有用但可能泄露信息或绕过业务逻辑的特殊界面）。  

与伪造请求能力相关的漏洞因应用程序而异，其重点在于破坏业务逻辑工作流，这与业务逻辑数据验证有所不同。

应用程序应设置逻辑检查机制，防止系统接受可能被攻击者利用来破坏业务逻辑、流程或应用流的伪造请求。请求伪造并非新技术，攻击者通过拦截代理向应用发送请求，通过查找、预测和操纵参数，使应用程序误判某些流程是否已执行，从而绕过业务逻辑。  

此外，伪造请求可能通过调用开发者和测试人员使用的“隐藏”功能（有时称为“彩蛋”）来破坏程序化或业务逻辑流程。彩蛋是指刻意隐藏在程序、电影、书籍等作品中的内部玩笑、隐藏信息或功能，名称源于传统的复活节彩蛋狩猎活动。

### 案例1

假设某电商影院网站允许用户选择票务，对整个订单应用一次性10%的老年人折扣，查看小计并完成交易。若攻击者通过代理发现应用程序存在一个隐藏字段（值为1或0），该字段被业务逻辑用于判断折扣是否已被使用。攻击者便可多次提交值为1（即"未使用折扣"）的请求，从而多次滥用同一折扣优惠。

### 案例2

假设某在线视频游戏根据玩家发现海盗宝藏、击败海盗和完成关卡的情况奖励代币，这些代币后续可兑换奖品。此外，每个关卡的积分会乘以对应关卡编号的系数。若攻击者通过代理发现开发测试阶段遗留的隐藏字段能直接跳转到最高关卡，即可快速积累非正常积分。

同理，如果攻击者通过代理发现存在用于开发测试的隐藏字段，可开启日志功能显示其他在线玩家或隐藏宝藏相对于攻击者的位置，便能迅速定位这些目标以获取积分。

## 测试目标

- 审查项目文档，查找字段的可猜测、可预测或隐藏功能。
- 插入逻辑有效数据以绕过正常业务逻辑工作流。

## 测试方法

### 通过识别可猜测值

- 使用拦截代理观察HTTP POST/GET请求，寻找值按固定间隔递增或容易被猜测的迹象。
- 若发现某些值可被猜测，修改这些值可能导致获得意外可见性。

### 通过识别隐藏选项

- 使用拦截代理观察HTTP POST/GET请求，寻找隐藏功能（如可开启或激活的调试功能）的迹象。
- 若发现此类功能，尝试猜测并修改相关值以触发应用程序的不同响应或行为。

## 相关测试案例

- [测试暴露会话变量/WSTG](../06-Session_Management_Testing/04-Testing_for_Exposed_Session_Variables.md)
- [测试跨站请求伪造（CSRF）/WSTG](../06-Session_Management_Testing/05-Testing_for_Cross_Site_Request_Forgery.md)
- [测试账户枚举和可猜测用户账户/WSTG](../03-Identity_Management_Testing/04-Testing_for_Account_Enumeration_and_Guessable_User_Account.md)

## 修复措施

应用程序必须具备足够的智能性，并在设计业务逻辑时确保能够防止攻击者预测和操纵参数以破坏程序化或业务逻辑流程，或利用隐藏/未文档化的功能（如调试功能）。

## Tools

- [Zed Attack Proxy (ZAP)](https://www.zaproxy.org)
- [Burp Suite](https://portswigger.net/burp)

## References

- [WSTG-BUSL-02](https://github.com/OWASP/wstg/blob/master/document/4-Web_Application_Security_Testing/10-Business_Logic_Testing/02-Test_Ability_to_Forge_Requests.md)
- [Easter egg](https://en.wikipedia.org/wiki/Easter_egg_(media))
- [Top 10 Software Easter Eggs](https://lifehacker.com/371083/top-10-software-easter-eggs)