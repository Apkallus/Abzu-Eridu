# 测试功能使用次数限制

## 概述

当前许多应用需要解决的问题涉及对功能使用次数或操作执行次数的限制。应用必须具备"足够智能"的逻辑，防止用户超出这些功能的使用限制，因为在多数场景中，每次功能调用都可能使用户获得某种需要向所有者支付对价的权益。例如：电商平台可能限制每笔交易仅允许使用一次折扣码，或某些订阅制应用可能限定用户每月仅能下载三篇完整文档。

功能限制相关的安全漏洞具有应用特异性，测试时需要构建异常使用场景，尝试突破应用程序/功能/操作允许的最大调用次数。

攻击者可能通过绕过业务逻辑限制，使功能执行次数超出"允许范围"，从而利用应用程序谋取私利。

### 示例

假设某电商平台允许用户在结算支付前使用多个折扣优惠中的任意一项。如果攻击者在已应用一次"允许"的折扣后，通过浏览器返回折扣选择页面，会发生什么？攻击者能否继续使用其他折扣？能否重复使用同一折扣多次？

## 测试目标

- 识别需要设置调用次数限制的功能模块
- 评估功能是否设有合理的逻辑限制及验证机制的有效性

## 测试方法

- 查阅项目文档并结合探索性测试，定位在业务逻辑工作流中应限制执行次数（单次或指定次数）的应用程序功能或系统特性
- 针对每个识别出的受限功能，设计异常使用场景测试用例，尝试突破允许执行次数的限制。例如：用户能否通过页面往返导航多次执行本应单次触发的功能？或通过重复加载/清空购物车获取额外折扣

## 相关测试用例

- [账户枚举及可猜测用户账户测试/WSTG](../03-Identity_Management_Testing/04-Testing_for_Account_Enumeration_and_Guessable_User_Account.md)
- [弱锁定机制测试/WSTG](../04-Authentication_Testing/03-Testing_for_Weak_Lock_Out_Mechanism.md)

## 修复方案

应用程序应设置硬性控制机制防止限制滥用。可通过以下方式实现：在数据库层将优惠券设置为失效状态，在后端或数据库层设置每用户计数器限制（所有用户均应通过会话进行身份识别），具体方案可根据业务需求选择。

## 参考文献

- [WSTG-BUSL-05](https://github.com/OWASP/wstg/blob/master/document/4-Web_Application_Security_Testing/10-Business_Logic_Testing/05-Test_Number_of_Times_a_Function_Can_Be_Used_Limits.md)
- [今早芝加哥商品交易所黄金交易因止损逻辑事件暂停](https://www.businessinsider.com/gold-halted-on-cme-for-stop-logic-event-2013-10)
