# 测试JavaScript执行

## 摘要

JavaScript注入漏洞是跨站脚本（XSS）攻击的一种子类型，其核心在于能够注入任意的JavaScript代码，并由应用程序在受害者浏览器中执行。此类漏洞可能导致多种严重后果，例如泄露用户会话Cookie（可用于冒充受害者），或更普遍地，使攻击者能够修改受害者所见页面内容或应用程序行为。

当应用程序缺乏对用户输入和输出的适当验证时，便可能出现JavaScript注入漏洞。由于JavaScript常用于动态填充网页内容，此类注入发生在内容处理阶段，并最终影响受害者。

在测试此漏洞时需注意，不同浏览器对某些字符的处理方式可能存在差异。具体可参考 [DOM型XSS](https://owasp.org/www-community/attacks/DOM_Based_XSS) 的相关说明。

以下示例脚本未对变量 `rr` 进行任何验证（该变量通过查询字符串获取用户输入），且未应用任何编码处理：

```js
var rr = location.search.substring(1);
if(rr) {
    window.location=decodeURIComponent(rr);
}
```

这意味着攻击者只需提交以下查询字符串即可注入JavaScript代码：`www.victim.com/?javascript:alert(1)`。

## 测试目标

- 识别接收端（Sinks）及可能的JavaScript注入点。

## 测试方法
需注意以下示例：[DOM型XSS练习](http://www.domxss.com/domxss/01_Basics/04_eval.html)

该页面包含以下脚本：

```html
<script>
function loadObj(){
    var cc=eval('('+aMess+')');
    document.getElementById('mess').textContent=cc.message;
}

if(window.location.hash.indexOf('message')==-1) {
    var aMess='({"message":"Hello User!"})';
} else {
    var aMess=location.hash.substr(window.location.hash.indexOf('message=')+8)
}
</script>
```

上述代码存在受攻击者控制的来源 `location.hash`，可直接向 `message` 值注入JavaScript代码以获取用户浏览器控制权。

## 引用

- [WSTG-CLNT-02](https://github.com/OWASP/wstg/blob/master/document/4-Web_Application_Security_Testing/11-Client-side_Testing/02-Testing_for_JavaScript_Execution.md)