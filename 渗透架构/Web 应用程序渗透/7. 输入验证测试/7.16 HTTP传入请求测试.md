# HTTP传入请求测试

## 概述

本节描述如何在客户端或服务端监控所有传入/传出的HTTP请求。此项测试的目的是验证后台是否存在不必要的或可疑的HTTP请求发送。

大多数Web安全测试工具（例如AppScan、BurpSuite、ZAP）都充当HTTP代理。这需要更改客户端应用程序或浏览器的代理设置。下面列出的测试技术主要侧重于如何在不更改客户端配置的情况下监控HTTP请求，这将更贴近生产环境使用场景。

## 测试目标

- 监控Web服务器的所有传入和传出HTTP请求，以检查是否存在可疑请求。
- 在不更改终端用户浏览器代理或客户端应用程序的情况下监控HTTP流量。

## 测试方法

<!--  -->
并非黑盒测试，并且实际上为web服务器端流量监控的工具使用而不是漏洞测试
<!--  -->

### 反向代理

在某些情况下，我们需要监控Web服务器上的所有传入HTTP请求，但无法更改浏览器或客户端应用程序的配置。在此场景下，我们可以在Web服务器上设置反向代理来监控所有传入/传出的请求。

对于Windows平台，推荐使用Fiddler Classic。它不仅提供监控功能，还可以编辑/重放HTTP请求。具体配置方法请参考[如何将Fiddler配置为反向代理](https://docs.telerik.com/fiddler/configure-fiddler/tasks/usefiddlerasreverseproxy)。

对于Linux平台，可使用Charles Web Debugging Proxy。

测试步骤：

1. 在Web服务器上安装Fiddler或Charles
2. 将Fiddler或Charles配置为反向代理
3. 捕获HTTP流量
4. 检查HTTP流量
5. 修改HTTP请求并重放修改后的请求进行测试

### 端口转发

端口转发是另一种无需更改客户端配置即可拦截HTTP请求的方法。您可以使用Charles作为SOCKS代理实现端口转发，或使用专门的端口转发工具。该技术允许我们将所有从客户端捕获的流量转发到Web服务器端口。

测试流程如下：

1. 在另一台机器或Web服务器上安装Charles或端口转发工具
2. 将Charles配置为SOCKS代理以实现端口转发

### TCP层网络流量捕获

该技术在TCP层监控所有网络流量。可使用TCPDump或WireShark工具。然而，这些工具不允许编辑捕获的流量或发送修改后的HTTP请求进行测试。如需重放捕获的流量（PCAP）数据包，可使用Ostinato工具。

测试步骤：

1. 在Web服务器上启动TCPDump或WireShark捕获网络流量
2. 监控捕获的文件（PCAP）
3. 根据需要利用Ostinato工具编辑PCAP文件
4. 重放HTTP请求

推荐使用Fiddler或Charles，因为这些工具既能捕获HTTP流量，又能轻松编辑/重放修改后的HTTP请求。此外，如果Web流量为HTTPS协议，Wireshark需要导入Web服务器私钥才能检查HTTPS消息体，否则捕获流量中的HTTPS消息体将全部处于加密状态。

## Tools

- [Fiddler](https://www.telerik.com/fiddler/)
- [TCPProxy](https://grinder.sourceforge.net/g3/tcpproxy.html)
- [Charles Web Debugging Proxy](https://www.charlesproxy.com/)
- [WireShark](https://www.wireshark.org/)
- [PowerEdit-Pcap](https://sourceforge.net/projects/powereditpcap/)
- [pcapteller](https://github.com/BlackArch/pcapteller)
- [replayproxy](https://github.com/sparrowt/replayproxy)
- [Ostinato](https://ostinato.org/)

## References

- [WSTG-INPV-16](https://github.com/OWASP/wstg/blob/master/document/4-Web_Application_Security_Testing/07-Input_Validation_Testing/16-Testing_for_HTTP_Incoming_Requests.md)
- [Charles Web Debugging Proxy](https://www.charlesproxy.com/)
- [Fiddler](https://www.telerik.com/fiddler/)
- [TCPDUMP](https://www.tcpdump.org/)
- [Ostinato](https://ostinato.org/)