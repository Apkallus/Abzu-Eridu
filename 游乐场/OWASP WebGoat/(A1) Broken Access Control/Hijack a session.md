---
id: CWE-341
title: Hijack a session                  
---
<!-- muse start -->
易于预测的cookie，分析后进行会话劫持。
获得一批连续的cookie进行分析，观察到前半部分递增而后半部分为时间戳。
前半部分缺失的cookie推测为其他用户的cookie，后半部分的时间戳即为范围，对此进行爆破。
<!-- muse end -->

概念：当会话ID缺乏复杂性和随机性，将导致应用程序容易受到基于会话的暴力攻击。
目标：获取属于他人的已认证会话的访问权限。

注：此处模拟真实登录状态，即受害者将在过程中进行登录操作。


- 获取 cookie：
    使用任意用户名与密码进行登录操作
    `POST http://localhost:3000/WebGoat/HijackSession/login HTTP/1.1`

    在编辑器中多次重发请求（请求头不包含 `hijack_cookie`）从响应中得到一批 Cookie 值
    ```http
    4432081934929974009-1767257995586
    4432081934929974010-1767257996049
    4432081934929974011-1767257996532
    4432081934929974013-1767257996979
    ```

- 分析 cookie：
    格式为“前半数字-后半数字”
    - 前半数字递增，几乎连续，缺失部分值。
        缺失的值即为其他用户尝试登录的cookie
    - 后半数字为时间戳（使用`Date.now()` 即可在浏览器控制台查看当前时间戳）

- 尝试获取已认证cookie：
    对包含前半部分缺失的值的cookie进行爆破，由与目标相邻请求的后半数字得到目标后半数字的时间戳范围

    选择目标的前半数字
    `4432081934929974012`

    相邻cookie
    ```
    4432081934929974011-1767257996532
    4432081934929974013-1767257996979
    ```

    后半范围为 1767257996532~979
    
    爆破后从响应的body大小不同的响应中得到成功信息
    