# Data Manipulation

您已经学习了管道数据传输、指定输入等操作。现在让我们开始整合所学内容吧！
在本模块中，您将学习一系列用于*操纵数据*的命令，这些命令将帮助您在Shell中取得优异成果。

### 待学习的更多程序

Shell高手们使用*数不胜数*的程序来操纵数据。
每个程序都有特定的不同功能，通常遵循[Unix哲学](https://en.wikipedia.org/wiki/Unix_philosophy)——做好一件事。
您可以将这些程序串联起来，形成非常强大的复合逻辑。
以下是一些示例（建议在完成Linux基础学习后自行掌握）：

- [awk](https://linux.die.net/man/1/awk) 用于复杂的文本处理
- [cut](https://linux.die.net/man/1/cut) 用于提取行的部分内容
- [less](https://linux.die.net/man/1/less) 交互式文件阅读器
- [more](https://linux.die.net/man/1/more) 分页阅读文件内容
- [paste](https://linux.die.net/man/1/paste) 合并文件
- [sed](https://linux.die.net/man/1/sed) 复杂的文本操作
- [sort](https://linux.die.net/man/1/sort) 数据排序
- [tail](https://linux.die.net/man/1/tail) 作为`head`命令的反向操作
- [uniq](https://linux.die.net/man/1/uniq) 过滤数据流中的重复项

## 挑战

### 翻译字符

管道传输数据的用途之一是*修改*数据。  
许多Linux命令能以非常巧妙的方式帮助您修改数据。  
其中之一是`tr`命令，它能转换通过标准输入接收的字符并将其输出到标准输出。  

在其最基础的用法中，`tr`将第一个参数中提供的字符转换为第二个参数中提供的字符：  

```console
hacker@dojo:~$ echo OWN | tr O P
PWN
hacker@dojo:~$
```

它还能处理多个字符，将第一个参数中不同位置的字符替换为第二个参数中对应的字符：  

```console
hacker@dojo:~$ echo PWM.COLLAGE | tr MA NE
PWN.COLLEGE
hacker@dojo:~$
``` 

现在，请尝试一下！  
在本关卡中，`/challenge/run`会打印出flag，但会交换所有字符的大小写（例如，`A`变为`a`，反之亦然）。  
您能否使用`tr`命令撤销该操作并获取flag？

### 删除字符

`tr` 命令还可以将字符转换为空（即*删除*它们）。
这可以通过 `-d` 标志和指定要删除的字符参数来实现：

```console
hacker@dojo:~$ echo PAWN | tr -d A
PWN
hacker@dojo:~$
```

很简单！
现在您来试试吧。
我会在flag字符中穿插一些干扰字符（具体为：`^` 和 `%`）。
请使用 `tr -d` 删除它们！

### 删除换行

一个常见的需要删除的字符类别是行分隔符。  
当您有一个数据流需要转换为单行以便进一步处理时，就会出现这种情况。  
您可以像处理其他字符一样指定换行符，通过*转义*它们：  

```console
hacker@dojo:~$ echo "hello_world!" | tr _ "\n"
hello
world!
hacker@dojo:~$
```

这里，反斜杠（`\`）表示其后面的字符代表一个难以直接在Shell中输入的字符。  
换行符当然难以输入，因为通常按`Enter`键时会直接运行命令本身。  
`\n`就是这个换行符的替代表示，并且它*必须*放在引号内，以防止Shell解释器本身尝试解释它，而是将其传递给`tr`。  
现在，让我们将其与删除操作结合起来。  
在这个挑战中，我们会在flag中注入一堆换行符。  
请使用`tr`的`-d`标志和*转义*的换行符说明来删除它们！  

----
**趣味小知识！**  
想要*实际*替换一个反斜杠（`\`）字符吗？  
因为`\`是转义字符，所以您需要转义它！  
`\\`会被`tr`视为一个反斜杠。  
虽然这与本次挑战无关，但依然是个有趣的小知识！

### 使用 head 提取前几行

在您的Linux学习之旅中，会遇到需要从输出冗长的程序中仅提取前几行内容的情况。
这时就需要用到`head`命令！
`head`命令用于显示输入内容的前几行：

```console
hacker@dojo:~$ cat /something/very/long | head
this
is
just
the
first
ten
lines
of
the
file
hacker@dojo:~$
```

默认显示前10行，但您可以通过`-n`选项控制显示行数：

```console
hacker@dojo:~$ cat /something/very/long | head -n 2
this
is
hacker@dojo:~$
```

本挑战的`/challenge/pwn`会输出大量数据，您需要通过管道将其传递给`head`命令仅获取前7行，然后将这些行继续通过管道传递给`/challenge/college`——如果操作正确，该程序将给出flag！
您的解决方案将是一个包含*两*个管道、连接三个命令的复合命令。
祝您好运！

### 提取文本的特定部分

有时，您需要提取特定的数据列，例如第一列、第三列或第42列。
这时可以使用`cut`命令。

例如，假设您有以下数据文件：

```console
hacker@dojo:~$ cat scores.txt
hacker 78 99 67
root 92 43 89
hacker@dojo:~$
```

您可以使用`cut`提取特定列：

```console
hacker@dojo:~$ cut -d " " -f 1 scores.txt
hacker
root
hacker@dojo:~$ cut -d " " -f 2 scores.txt
78
92
hacker@dojo:~$ cut -d " " -f 3 scores.txt
99
43
hacker@dojo:~$
```

`-d`参数指定列*分隔符*（列之间的分隔方式）。
本例中为空格字符。
当然，此处必须使用引号包裹，以便Shell识别该空格是参数内容而非参数分隔符！
`-f`参数指定*字段*编号（要提取的列序号）。

在本挑战中，`/challenge/run`程序将输出多行包含随机数字和单个字符（即flag字符）作为列的数据。
请使用`cut`提取flag字符，然后通过管道传递给`tr -d "\n"`（类似前一关的操作！）将其合并为单行。
您的解决方案应类似：`/challenge/run | cut ??? | tr ???`，其中`???`需根据实际情况填写。


### 排序数据

文件（或命令的输出行）并不总是按照您需要的顺序排列！  
`sort`命令可以帮助您整理数据。  
它从输入（或文件）中读取行，并按排序后的顺序输出它们：  

```console
hacker@dojo:~$ cat names.txt
  hack
  the
  planet
  with
  pwn
  college
hacker@dojo:~$ sort names.txt
  college
  hack
  planet
  pwn
  the
  with
hacker@dojo:~$
```
  
默认情况下，`sort`按字母顺序排列行。  
参数可以改变此行为：  
- `-r`：反向排序（从Z到A）  
- `-n`：数值排序（针对数字）  
- `-u`：仅保留唯一行（*删除重复项*）  
- `-R`：随机顺序！  
在这个挑战中，`/challenge/flags.txt`文件中包含100个假flag，真正的flag混杂其中。  
当按字母顺序排序时，真正的flag会出现在末尾（我们在生成假flag时已确保这一点）。  
去获取它吧！
