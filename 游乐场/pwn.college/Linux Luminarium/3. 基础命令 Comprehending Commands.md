# Comprehending Commands

本模块将引导你学习一些实用的 Linux 命令，这些命令将为你后续的学习之旅提供帮助！
这远非完整列表，我们将持续扩展本模块内容，但现有内容已足够助你入门。

那么，事不宜迟，让我们开始学习命令吧！

## 挑战

### cat：不是宠物，而是命令！

最关键的 Linux 命令之一是 `cat`。
`cat` 最常用于读取文件，如下所示：

```console
hacker@dojo:~$ cat /challenge/DESCRIPTION.md
One of the most critical Linux commands is `cat`.
`cat` is most often used for reading out files, like so:
```

`cat` 可以拼接（con*cat*enate，因此得名）多个文件（当提供多个参数时）。例如：

```console
hacker@dojo:~$ cat myfile
This is my file!
hacker@dojo:~$ cat yourfile
This is your file!
hacker@dojo:~$ cat myfile yourfile
This is my file!
This is your file!
hacker@dojo:~$ cat myfile yourfile myfile
This is my file!
This is your file!
This is my file!
```

最后，如果不提供任何参数，`cat` 将从终端输入读取并输出内容。我们将在后续挑战中探索此功能...

在本挑战中，我会将 flag 复制到你的主目录（即 shell 启动位置）下的 `flag` 文件中。请使用 `cat` 命令读取它！

### 使用绝对路径

在上一关卡中，你使用 `cat flag` 从主目录读取了 flag！
当然，你也可以将 `cat` 的参数指定为绝对路径：

```console
hacker@dojo:~$ cat /challenge/DESCRIPTION.md
In the last level, you did `cat flag` to read the flag out of your home directory!
You can, of course, specify `cat`'s arguments as absolute paths:
...
```

在本挑战中，我不会将 flag 复制到你的主目录，但会使其可读。你可以通过绝对路径 `/flag` 使用 `cat` 命令读取它。

> **趣味小知识：**
在 pwn.college 中，flag *始终*存放在 `/flag` 路径下，但与本挑战不同，通常你无法直接访问该文件。

### 更多使用绝对路径练习

你可以指定各种路径作为命令参数，我们将通过 `cat` 命令进行更多练习。
在本关卡中，我会将 flag 存放在某个复杂目录中，并且不允许你使用 `cd` 命令切换目录，因此你无法直接使用 `cat flag` 读取。
你必须通过绝对路径获取 flag，无论它存放在何处。

### 在干草堆里找针

有时，你需要使用 `cat` 读取的文件可能过大。
幸运的是，我们可以使用 `grep` 命令来搜索所需内容！
我们将在本挑战中学习该命令。

`grep` 有多种使用方法，这里我们将学习其中一种：

```console
hacker@dojo:~$ grep SEARCH_STRING /path/to/file
```

按此方式调用时，`grep` 会在文件中搜索包含 `SEARCH_STRING` 的文本行并将其打印到控制台。

在本挑战中，我已向 `/challenge/data.txt` 文件注入了十万行文本。
请使用 `grep` 命令搜索 flag！

提示：flag 始终以 `pwn.college` 文本开头。

### 比较文件

在比较相似文件之间的差异时，仅凭肉眼观察可能并非最高效的方法！
此时 `diff` 命令就显得尤为宝贵。

`diff` 会逐行比较两个文件，并精确显示它们之间的差异。
例如：

```console
hacker@dojo:~$ cat file1
hello
world
hacker@dojo:~$ cat file2
hello
universe
hacker@dojo:~$ diff file1 file2
2c2
< world
---
> universe
```

输出结果告诉我们第2行发生了更改（`2c2`），第一个文件中的 `world`（`<`）在第二个文件中被替换为 `universe`（`>`）。

有时，当添加新行时，你会看到如下输出：

```console
hacker@dojo:~$ cat old
pwn
hacker@dojo:~$ cat new
pwn
college
hacker@dojo:~$ diff old new
1a2
> college
```

这表示在第一个文件的第1行之后，第二个文件多出了一行（`1a2` 意为"在文件1的第1行后添加文件2的第2行"）。

现在开始你的挑战！
`/challenge` 目录下存在两个文件：
- `/challenge/decoys_only.txt` 包含100个假flag
- `/challenge/decoys_and_real.txt` 包含全部100个假flag外加一个真flag

使用 `diff` 命令找出这两个文件的差异并获取你的flag！

### 列出文件

到目前为止，我们一直告知你需要操作哪些文件。
但目录中可能包含大量文件（及其他子目录），而我们无法始终告知你其具体名称。
你需要学会使用 `ls` 命令**列**出目录内容！

`ls` 可列出参数所指定目录中的文件，若未提供参数则默认列出当前目录内容。
示例如下：

```console
hacker@dojo:~$ ls /challenge
run
hacker@dojo:~$ ls
Desktop    Downloads  Pictures  Templates
Documents  Music      Public    Videos
hacker@dojo:~$ ls /home/hacker
Desktop    Downloads  Pictures  Templates
Documents  Music      Public    Videos
hacker@dojo:~$
```

在本挑战中，我们将 `/challenge/run` 随机重命名！
请列出 `/challenge` 目录中的文件以定位其名称。

### 创建文件

当然，你也可以*创建*文件！
有多种方法可以实现此操作，这里我们将介绍一个简单命令。
你可以通过 `touch` 命令*触碰*文件来创建新的空文件：

```sh
hacker@dojo:~$ cd /tmp
hacker@dojo:/tmp$ ls
hacker@dojo:/tmp$ touch pwnfile
hacker@dojo:/tmp$ ls
pwnfile
hacker@dojo:/tmp$
```

操作就是如此简单！
在本关卡中，请创建两个文件：`/tmp/pwn` 和 `/tmp/college`，然后运行 `/challenge/run` 以获取 flag！

### 删除文件

文件无处不在。
就像糖果包装纸一样，它们的数量终将过多。
在本关卡中，我们将学习清理操作！

在 Linux 系统中，你可以使用 `rm` 命令删除（*re*move）文件，操作如下：

```console
hacker@dojo:~$ touch PWN
hacker@dojo:~$ touch COLLEGE
hacker@dojo:~$ ls
COLLEGE     PWN
hacker@dojo:~$ rm PWN
hacker@dojo:~$ ls
COLLEGE
hacker@dojo:~$
```

让我们来练习吧。
本挑战将在你的主目录下创建一个 `delete_me` 文件！
请删除该文件，然后运行 `/challenge/check` 程序——该程序会验证你是否已成功删除文件，随后为你提供 flag！

### 移动文件/重命名

你也可以使用 `mv` 命令*移动*文件。
使用方法非常简单：

```console
hacker@dojo:~$ ls
my-file
hacker@dojo:~$ cat my-file
PWN!
hacker@dojo:~$ mv my-file your-file
hacker@dojo:~$ ls
your-file
hacker@dojo:~$ cat your-file
PWN!
hacker@dojo:~$
```

本挑战要求你将 `/flag` 文件移动到 `/tmp/hack-the-planet` 目录（请执行此操作）！
完成后请运行 `/challenge/check` 程序，该程序会进行验证并向你提供 flag。

### 复制文件

但如果你想要保留原始文件该怎么办？你可以使用 `cp` 命令实现此需求。
其用法与 `mv` 命令相同，但会保留源文件。

本挑战要求你将 `/flag` 文件复制到 `/tmp/hack-the-planet` 目录（请执行此操作）！
完成后请运行 `/challenge/check` 程序，该程序会进行验证并向你提供 flag。

### 隐藏文件

有趣的是，`ls` 命令默认不会列出*所有*文件。  
Linux 有一个约定：以 `.` 开头的文件默认不会在 `ls` 命令及其他某些场景中显示。  
若要通过 `ls` 查看这些文件，需要使用 `-a` 参数调用 `ls`，如下所示：

```console
hacker@dojo:~$ touch pwn
hacker@dojo:~$ touch .college
hacker@dojo:~$ ls
pwn
hacker@dojo:~$ ls -a
.college	pwn
hacker@dojo:~$
```

现在轮到你了！  
去查找隐藏在 `/` 目录下以点开头的文件中的 flag。

### 一场史诗般的文件系统冒险

借助你对 `cd`、`ls` 和 `cat` 的了解，我们准备玩一个小游戏！

我们将从 `/` 目录开始。通常情况下：

```console
hacker@dojo:~$ cd /
hacker@dojo:/$ ls
bin   challenge  etc   home  lib32  libx32  mnt  proc  run   srv  tmp  var
boot  dev        flag  lib   lib64  media   opt  root  sbin  sys  usr
```

内容真不少！  
总有一天你会对它们非常熟悉，但你现在可能已经认出了 `flag` 文件和 `challenge` 目录。

在这个挑战中，我*隐藏了 flag*！  
在这里，你需要使用 `ls` 和 `cat` 来跟随我的线索找到它！  
规则如下：

0. 你的第一条线索在 `/` 目录中。请先切换到该目录。
1. 使用 `ls` 查看周围内容。会有一个名为 HINT 或 CLUE 或类似名称的文件！
2. 使用 `cat` 读取该文件中的线索！
3. 根据线索提示，前往下一个目录（或保持不动）！
4. 跟随线索找到 flag！

祝你好运！

### 创建目录

我们可以创建文件。  
那目录呢？  
你可以使用 `mkdir` 命令创建目录（**m**a**k**e **dir**ectories）。  
然后你可以在里面存放文件！  

例如：

```sh
hacker@dojo:~$ cd /tmp
hacker@dojo:/tmp$ ls
hacker@dojo:/tmp$ mkdir my_directory
hacker@dojo:/tmp$ ls
my_directory
hacker@dojo:/tmp$ cd my_directory
hacker@dojo:/tmp/my_directory$ touch my_file
hacker@dojo:/tmp/my_directory$ ls
my_file
hacker@dojo:/tmp/my_directory$ ls /tmp/my_directory/my_file
/tmp/my_directory/my_file
hacker@dojo:/tmp/my_directory$
```

现在，去创建一个 `/tmp/pwn` 目录并在其中创建一个 `college` 文件！  
然后运行 `/challenge/run`，该命令将检查你的解决方案并为你提供 flag！

### 查找文件

现在我们知道了如何列出、读取和创建文件。  
但如何查找文件呢？  
我们使用 `find` 命令！

`find` 命令接受描述搜索条件和搜索位置的可选参数。  
如果未指定搜索条件，`find` 将匹配所有文件。  
如果未指定搜索位置，`find` 将使用当前工作目录（`.`）。  

未指定搜索位置：

```console
hacker@dojo:~$ mkdir my_directory
hacker@dojo:~$ mkdir my_directory/my_subdirectory
hacker@dojo:~$ touch my_directory/my_file
hacker@dojo:~$ touch my_directory/my_subdirectory/my_subfile
hacker@dojo:~$ find
.
./my_directory
./my_directory/my_subdirectory
./my_directory/my_subdirectory/my_subfile
./my_directory/my_file
hacker@dojo:~$
```

指定搜索位置：

```console
hacker@dojo:~$ find my_directory/my_subdirectory
my_directory/my_subdirectory
my_directory/my_subdirectory/my_subfile
hacker@dojo:~$
```

当然，我们也可以指定搜索条件！  
例如，这里我们按名称过滤：

```console
hacker@dojo:~$ find -name my_subfile
./my_directory/my_subdirectory/my_subfile
hacker@dojo:~$ find -name my_subdirectory
./my_directory/my_subdirectory
hacker@dojo:~$
```

如果你愿意，可以搜索整个文件系统！

```console
hacker@dojo:~$ find / -name hacker
/home/hacker
hacker@dojo:~$
```

现在轮到你了。  
我将 flag 隐藏在了文件系统的随机目录中。  
它仍然名为 `flag`。  
去找到它吧！

注意事项：  
首先，文件系统上存在其他名为 `flag` 的文件。  
如果你尝试的第一个文件没有包含真正的 flag，请不要惊慌。  
其次，文件系统中有许多地方普通用户无法访问。  
这会导致 `find` 生成错误，但你可以忽略这些错误；我们不会将 flag 隐藏在那里！  
最后，`find` 可能需要一些时间；请耐心等待！

### 链接文件

如果你使用 Linux（或计算机）进行任何实际工作达到一定时间，最终会遇到以下某种情况：你希望两个程序访问相同的数据，但程序期望这些数据位于两个不同的位置。  
幸运的是，Linux 为这个难题提供了解决方案：*链接*。

链接分为两种类型：*硬*链接和*软*链接（也称为*符号*链接）。  

在文件系统中，文件在概念上是存储其内容的地址。  
硬链接是索引该数据的备用地址——访问硬链接和访问原始文件完全等同，都能立即获取所需数据。  
而软/符号链接则包含原始文件名。当你访问符号链接时，Linux 会识别它是一个符号链接，读取原始文件名，然后（通常）自动访问该文件。  
在大多数情况下，两种方式都能访问原始数据，但机制不同。

对大多数人来说，硬链接听起来更简单（如上所述，我用一句话解释硬链接，而软链接用了两句），但硬链接存在各种缺点和实现陷阱，使得软/符号链接成为更流行的选择。

在本挑战中，我们将学习符号链接（也称为 *symlinks*）。  
符号链接通过带 `-s` 参数的 `ln` 命令创建，如下所示：

```console
hacker@dojo:~$ cat /tmp/myfile
This is my file!
hacker@dojo:~$ ln -s /tmp/myfile /home/hacker/ourfile
hacker@dojo:~$ cat ~/ourfile
This is my file!
hacker@dojo:~$
```

可以看到，访问符号链接会得到原始文件的内容！  
另外，你可以看到 `ln -s` 的用法。注意命令中原始文件路径在链接路径*之前*！

有几种方法可以识别符号链接。例如，`file` 命令（接收文件名并告诉你文件类型）可以识别符号链接：

```console
hacker@dojo:~$ file /tmp/myfile
/tmp/myfile: ASCII text
hacker@dojo:~$ file ~/ourfile
/home/hacker/ourfile: symbolic link to /tmp/myfile
hacker@dojo:~$
```

好了，现在你来试试！  
本关卡中 flag 依旧在 `/flag` 中，但 `/challenge/catflag` 会读取 `/home/hacker/not-the-flag`。  
使用符号链接，骗过它来获取 flag！
